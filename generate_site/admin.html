<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMS - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --sidebar-width: 260px;
            --header-height: 60px;
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --bg-dark: #0f172a;
            --bg-darker: #020617;
            --bg-card: #1e293b;
            --bg-input: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #334155;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .admin-layout { display: flex; min-height: 100vh; }

        /* Sidebar */
        .admin-sidebar {
            width: var(--sidebar-width);
            background: var(--bg-darker);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }

        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border-color); }
        .sidebar-logo { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--text-primary); }
        .sidebar-logo i { font-size: 24px; color: var(--primary); }
        .sidebar-logo span { font-size: 18px; font-weight: 600; }

        .project-selector { padding: 16px; border-bottom: 1px solid var(--border-color); position: relative; }
        .project-dropdown {
            width: 100%; padding: 10px 12px; background: var(--bg-input);
            border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary);
            font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: space-between;
        }
        .project-dropdown:hover { border-color: var(--primary); }
        .project-dropdown .project-name { display: flex; align-items: center; gap: 8px; overflow: hidden; }
        .project-dropdown .project-name i { color: var(--primary); }

        .project-menu {
            display: none; position: absolute; left: 16px; right: 16px; top: 100%;
            background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-height: 300px; overflow-y: auto; z-index: 200;
        }
        .project-menu.open { display: block; }
        .project-menu-item { padding: 12px 16px; display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .project-menu-item:hover { background: var(--bg-input); }
        .project-menu-item.active { background: rgba(59,130,246,0.1); color: var(--primary); }
        .project-menu-divider { border-top: 1px solid var(--border-color); margin: 8px 0; }
        .project-menu-item.create { color: var(--primary); }

        .sidebar-nav { flex: 1; overflow-y: auto; padding: 16px 0; }
        .nav-section { margin-bottom: 8px; }
        .nav-section-title { padding: 8px 20px; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); font-weight: 600; }
        .nav-item {
            display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: var(--text-secondary);
            text-decoration: none; cursor: pointer; transition: all 0.2s; border-left: 3px solid transparent;
        }
        .nav-item:hover { background: rgba(59,130,246,0.1); color: var(--text-primary); }
        .nav-item.active { background: rgba(59,130,246,0.15); color: var(--primary); border-left-color: var(--primary); }
        .nav-item i { width: 20px; text-align: center; }
        .nav-item .badge { background: var(--bg-input); padding: 2px 8px; border-radius: 10px; font-size: 11px; }

        .nav-submenu { display: none; padding-left: 32px; }
        .nav-submenu.open { display: block; }
        .nav-item-parent .arrow { transition: transform 0.2s; }
        .nav-item-parent.open .arrow { transform: rotate(90deg); }

        .sidebar-footer { padding: 16px 20px; border-top: 1px solid var(--border-color); }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; }
        .user-details { flex: 1; }
        .user-name { font-weight: 500; }
        .user-role { font-size: 12px; color: var(--text-muted); }

        .admin-main { flex: 1; margin-left: var(--sidebar-width); display: flex; flex-direction: column; }

        .admin-header {
            height: var(--header-height); background: var(--bg-darker); border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: space-between; padding: 0 24px;
            position: sticky; top: 0; z-index: 50;
        }
        .header-title h1 { font-size: 20px; font-weight: 600; }
        .header-actions { display: flex; align-items: center; gap: 12px; }

        .btn {
            padding: 10px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: 500;
            cursor: pointer; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-secondary { background: var(--bg-input); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-icon { width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 8px; background: var(--bg-input); color: var(--text-secondary); border: 1px solid var(--border-color); }

        .admin-content { flex: 1; padding: 24px; overflow-y: auto; }
        .section { display: none; }
        .section.active { display: block; }

        /* Cards */
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; overflow: hidden; transition: all 0.2s; }
        .card:hover { border-color: var(--primary); box-shadow: 0 4px 20px rgba(59,130,246,0.1); }
        .card-preview { height: 160px; background: var(--bg-darker); display: flex; align-items: center; justify-content: center; }
        .card-preview-placeholder { color: var(--text-muted); font-size: 48px; }
        .card-body { padding: 16px; }
        .card-title { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .card-title input { flex: 1; background: none; border: none; font-size: 16px; font-weight: 600; color: var(--text-primary); padding: 4px; width: 100%; }
        .card-title input:focus { outline: none; background: var(--bg-input); border-radius: 4px; }
        .card-meta { font-size: 12px; color: var(--text-muted); margin-bottom: 12px; }
        .card-actions { display: flex; gap: 8px; }
        .card-action { flex: 1; padding: 8px; border: 1px solid var(--border-color); background: none; color: var(--text-secondary); border-radius: 6px; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .card-action:hover { background: var(--bg-input); color: var(--text-primary); }
        .card-action.primary { background: var(--primary); border-color: var(--primary); color: white; }
        .card-action.danger:hover { background: var(--danger); border-color: var(--danger); color: white; }
        .card.new { border: 2px dashed var(--border-color); display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 240px; cursor: pointer; }
        .card.new:hover { border-color: var(--primary); background: rgba(59,130,246,0.05); }
        .card.new i { font-size: 48px; color: var(--text-muted); margin-bottom: 12px; }
        .card.new span { color: var(--text-secondary); }

        /* Pages Layout */
        .pages-layout { display: flex; gap: 24px; }
        .pages-sidebar { width: 250px; flex-shrink: 0; }
        .pages-main { flex: 1; }

        .folder-tree { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; }
        .folder-tree-header { padding: 16px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; }
        .folder-tree-header h3 { font-size: 14px; font-weight: 600; }
        .folder-item { padding: 10px 16px; display: flex; align-items: center; gap: 10px; cursor: pointer; border-left: 3px solid transparent; }
        .folder-item:hover { background: var(--bg-input); }
        .folder-item.active { background: rgba(59,130,246,0.1); border-left-color: var(--primary); color: var(--primary); }
        .folder-item i { color: inherit; }
        .folder-item span { flex: 1; }
        .folder-item .count { font-size: 12px; color: var(--text-muted); background: var(--bg-input); padding: 2px 8px; border-radius: 10px; }

        /* Tabs */
        .tabs { display: flex; gap: 4px; margin-bottom: 24px; border-bottom: 1px solid var(--border-color); padding-bottom: 16px; flex-wrap: wrap; }
        .tab { padding: 10px 20px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-secondary); font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .tab:hover { background: var(--bg-input); color: var(--text-primary); }
        .tab.active { background: var(--primary); border-color: var(--primary); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Template Categories */
        .template-categories { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .template-category { padding: 8px 16px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-secondary); font-size: 13px; cursor: pointer; }
        .template-category:hover { background: var(--bg-card); color: var(--text-primary); }
        .template-category.active { background: var(--primary); border-color: var(--primary); color: white; }

        .templates-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; }
        .template-card { background: var(--bg-input); border: 2px solid var(--border-color); border-radius: 12px; padding: 24px 16px; cursor: pointer; text-align: center; transition: all 0.2s; }
        .template-card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .template-card.selected { border-color: var(--primary); background: rgba(59,130,246,0.1); }
        .template-card-icon { font-size: 40px; margin-bottom: 12px; }
        .template-card-name { font-size: 14px; font-weight: 500; }

        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; }
        .stat-card-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; margin-bottom: 12px; }
        .stat-card-icon.blue { background: rgba(59,130,246,0.1); color: var(--primary); }
        .stat-card-icon.green { background: rgba(16,185,129,0.1); color: var(--success); }
        .stat-card-icon.yellow { background: rgba(245,158,11,0.1); color: var(--warning); }
        .stat-card-value { font-size: 28px; font-weight: 700; margin-bottom: 4px; }
        .stat-card-label { color: var(--text-muted); font-size: 14px; }

        /* Tables */
        .table-container { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; overflow: hidden; }
        .table-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid var(--border-color); }
        .table-search input { padding: 8px 16px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); width: 250px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 14px 20px; text-align: left; }
        th { background: var(--bg-darker); font-weight: 600; font-size: 12px; text-transform: uppercase; color: var(--text-muted); }
        td { border-top: 1px solid var(--border-color); }
        .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; border-radius: 20px; font-size: 12px; }
        .status-badge.active { background: rgba(16,185,129,0.1); color: var(--success); }
        .table-actions { display: flex; gap: 8px; }
        .table-action { width: 32px; height: 32px; border: none; background: var(--bg-input); color: var(--text-secondary); border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .table-action:hover { background: var(--primary); color: white; }
        .table-avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 500; }

        /* Modal - CENTERED */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7); z-index: 1000;
            align-items: center; justify-content: center;
        }
        .modal-overlay.open { display: flex; }
        .modal {
            background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px;
            width: 90%; max-width: 500px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;
            margin: auto; align-self: center;
        }
        .modal.large { max-width: 800px; }
        .modal.xlarge { max-width: 1100px; }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; }
        .modal-header h2 { font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .modal-header h2 i { color: var(--primary); }
        .modal-close { width: 32px; height: 32px; border: none; background: var(--bg-input); color: var(--text-secondary); border-radius: 8px; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }
        .modal-close:hover { background: var(--danger); color: white; }
        .modal-body { padding: 24px; overflow-y: auto; flex: 1; }
        .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 12px; }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px 16px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 14px; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary); }

        .empty-state { text-align: center; padding: 60px 20px; }
        .empty-state i { font-size: 64px; color: var(--text-muted); margin-bottom: 16px; }
        .empty-state h3 { font-size: 18px; margin-bottom: 8px; }
        .empty-state p { color: var(--text-secondary); margin-bottom: 24px; }

        @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) {
            .admin-sidebar { transform: translateX(-100%); }
            .admin-main { margin-left: 0; }
            .pages-layout { flex-direction: column; }
            .pages-sidebar { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="sidebar-logo">
                    <i class="fas fa-cubes"></i>
                    <span>AI CMS</span>
                </a>
            </div>

            <div class="project-selector">
                <div class="project-dropdown" id="projectDropdown">
                    <div class="project-name">
                        <i class="fas fa-folder"></i>
                        <span id="currentProjectName">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç</span>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="project-menu" id="projectMenu"></div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">–û—Å–Ω–æ–≤–Ω–æ–µ</div>
                    <a class="nav-item active" data-section="dashboard">
                        <i class="fas fa-home"></i>
                        <span>–î–∞—à–±–æ—Ä–¥</span>
                    </a>
                    <a class="nav-item" data-section="pages">
                        <i class="fas fa-file-alt"></i>
                        <span>–°—Ç—Ä–∞–Ω–∏—Ü—ã</span>
                        <span class="badge" id="pagesCount">0</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–ö–∞—Ç–∞–ª–æ–≥</div>
                    <div class="nav-item nav-item-parent" data-submenu="products">
                        <i class="fas fa-shopping-bag"></i>
                        <span>–¢–æ–≤–∞—Ä—ã/–£—Å–ª—É–≥–∏</span>
                        <i class="fas fa-chevron-right arrow"></i>
                    </div>
                    <div class="nav-submenu" id="submenu-products">
                        <a class="nav-item" data-section="products"><i class="fas fa-box"></i><span>–¢–æ–≤–∞—Ä—ã</span></a>
                        <a class="nav-item" data-section="services"><i class="fas fa-concierge-bell"></i><span>–£—Å–ª—É–≥–∏</span></a>
                        <a class="nav-item" data-section="digital"><i class="fas fa-cloud-download-alt"></i><span>–û–Ω–ª–∞–π–Ω-–ø—Ä–æ–¥—É–∫—Ç—ã</span></a>
                        <a class="nav-item" data-section="specialists"><i class="fas fa-user-tie"></i><span>–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã</span></a>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–ü—Ä–æ–¥–∞–∂–∏</div>
                    <div class="nav-item nav-item-parent" data-submenu="orders">
                        <i class="fas fa-shopping-cart"></i>
                        <span>–ó–∞–∫–∞–∑—ã</span>
                        <i class="fas fa-chevron-right arrow"></i>
                    </div>
                    <div class="nav-submenu" id="submenu-orders">
                        <a class="nav-item" data-section="orders"><i class="fas fa-receipt"></i><span>–ó–∞–∫–∞–∑—ã</span></a>
                        <a class="nav-item" data-section="payments"><i class="fas fa-credit-card"></i><span>–ü–ª–∞—Ç–µ–∂–∏</span></a>
                        <a class="nav-item" data-section="warehouse"><i class="fas fa-warehouse"></i><span>–°–∫–ª–∞–¥</span></a>
                        <a class="nav-item" data-section="delivery"><i class="fas fa-truck"></i><span>–î–æ—Å—Ç–∞–≤–∫–∞</span></a>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                    <a class="nav-item" data-section="users"><i class="fas fa-users"></i><span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span></a>
                    <a class="nav-item" data-section="settings"><i class="fas fa-cog"></i><span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">–ê</div>
                    <div class="user-details">
                        <div class="user-name">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                        <div class="user-role">–í–ª–∞–¥–µ–ª–µ—Ü</div>
                    </div>
                    <button class="btn-icon" title="–í—ã–π—Ç–∏" onclick="doLogout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </aside>

        <main class="admin-main">
            <header class="admin-header">
                <div class="header-title">
                    <h1 id="sectionTitle">–î–∞—à–±–æ—Ä–¥</h1>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" id="mainActionBtn" onclick="createPage()">
                        <i class="fas fa-plus"></i>
                        <span>–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</span>
                    </button>
                </div>
            </header>

            <div class="admin-content">
                <!-- Dashboard -->
                <section class="section active" id="section-dashboard">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-icon blue"><i class="fas fa-file-alt"></i></div>
                            <div class="stat-card-value" id="stat-pages">0</div>
                            <div class="stat-card-label">–°—Ç—Ä–∞–Ω–∏—Ü</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon green"><i class="fas fa-envelope"></i></div>
                            <div class="stat-card-value" id="stat-submissions">0</div>
                            <div class="stat-card-label">–ó–∞—è–≤–æ–∫</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon yellow"><i class="fas fa-shopping-cart"></i></div>
                            <div class="stat-card-value" id="stat-orders">0</div>
                            <div class="stat-card-label">–ó–∞–∫–∞–∑–æ–≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon blue"><i class="fas fa-users"></i></div>
                            <div class="stat-card-value" id="stat-users">1</div>
                            <div class="stat-card-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        </div>
                    </div>
                    <h3 style="margin-bottom: 16px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h3>
                    <div class="cards-grid" id="recentPages"></div>
                </section>

                <!-- Pages Section -->
                <section class="section" id="section-pages">
                    <div class="tabs">
                        <button class="tab active" data-tab="my-pages"><i class="fas fa-file-alt"></i> –ú–æ–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</button>
                        <button class="tab" data-tab="templates"><i class="fas fa-palette"></i> –®–∞–±–ª–æ–Ω—ã</button>
                        <button class="tab" data-tab="submissions"><i class="fas fa-envelope"></i> –ó–∞—è–≤–∫–∏ <span class="badge" id="submissionsBadge">0</span></button>
                    </div>

                    <div class="tab-content active" id="tab-my-pages">
                        <div class="pages-layout">
                            <div class="pages-sidebar">
                                <div class="folder-tree">
                                    <div class="folder-tree-header">
                                        <h3>–ü–∞–ø–∫–∏</h3>
                                        <button class="btn-icon" title="–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É" onclick="createFolder()">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    <div class="folder-item active" data-folder="all" onclick="selectFolder('all')">
                                        <i class="fas fa-folder"></i>
                                        <span>–í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</span>
                                        <span class="count" id="allPagesCount">0</span>
                                    </div>
                                    <div class="folder-item" data-folder="landings" onclick="selectFolder('landings')">
                                        <i class="fas fa-rocket"></i>
                                        <span>–õ–µ–Ω–¥–∏–Ω–≥–∏</span>
                                        <span class="count" id="landingsCount">0</span>
                                    </div>
                                    <div id="foldersList"></div>
                                </div>
                            </div>
                            <div class="pages-main">
                                <div class="cards-grid" id="pagesGrid"></div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="tab-templates">
                        <div class="template-categories">
                            <button class="template-category active" data-category="all">–í—Å–µ</button>
                            <button class="template-category" data-category="basic">–ë–∞–∑–æ–≤—ã–µ</button>
                            <button class="template-category" data-category="personal">–õ–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥</button>
                            <button class="template-category" data-category="shop">–ú–∞–≥–∞–∑–∏–Ω</button>
                            <button class="template-category" data-category="realestate">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</button>
                            <button class="template-category" data-category="restaurant">–†–µ—Å—Ç–æ—Ä–∞–Ω—ã</button>
                            <button class="template-category" data-category="fitness">–§–∏—Ç–Ω–µ—Å</button>
                            <button class="template-category" data-category="education">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</button>
                            <button class="template-category" data-category="services">–£—Å–ª—É–≥–∏</button>
                            <button class="template-category" data-category="events">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</button>
                        </div>
                        <div class="templates-grid" id="templatesGrid"></div>
                    </div>

                    <div class="tab-content" id="tab-submissions">
                        <div class="table-container">
                            <div class="table-header">
                                <div class="table-search">
                                    <input type="text" placeholder="–ü–æ–∏—Å–∫ –∑–∞—è–≤–æ–∫...">
                                </div>
                                <button class="btn btn-secondary"><i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç</button>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–ò–º—è</th>
                                        <th>–ö–æ–Ω—Ç–∞–∫—Ç</th>
                                        <th>–°—Ç—Ä–∞–Ω–∏—Ü–∞</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="submissionsTable">
                                    <tr><td colspan="5"><div class="empty-state"><i class="fas fa-inbox"></i><h3>–ù–µ—Ç –∑–∞—è–≤–æ–∫</h3></div></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Other sections remain similar but simplified -->
                <section class="section" id="section-products">
                    <div class="empty-state"><i class="fas fa-box-open"></i><h3>–¢–æ–≤–∞—Ä—ã</h3><p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p></div>
                </section>
                <section class="section" id="section-services">
                    <div class="empty-state"><i class="fas fa-concierge-bell"></i><h3>–£—Å–ª—É–≥–∏</h3><p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p></div>
                </section>
                <section class="section" id="section-digital">
                    <div class="empty-state"><i class="fas fa-cloud"></i><h3>–û–Ω–ª–∞–π–Ω-–ø—Ä–æ–¥—É–∫—Ç—ã</h3><p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p></div>
                </section>
                <section class="section" id="section-specialists">
                    <div class="empty-state"><i class="fas fa-user-tie"></i><h3>–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã</h3><p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p></div>
                </section>
                <section class="section" id="section-orders">
                    <div class="empty-state"><i class="fas fa-shopping-cart"></i><h3>–ó–∞–∫–∞–∑—ã</h3><p>–ó–∞–∫–∞–∑—ã –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤—ã—Ö –ø—Ä–æ–¥–∞–∂</p></div>
                </section>
                <section class="section" id="section-payments">
                    <div class="empty-state"><i class="fas fa-credit-card"></i><h3>–ü–ª–∞—Ç–µ–∂–∏</h3><p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p></div>
                </section>
                <section class="section" id="section-warehouse">
                    <div class="empty-state"><i class="fas fa-warehouse"></i><h3>–°–∫–ª–∞–¥</h3><p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p></div>
                </section>
                <section class="section" id="section-delivery">
                    <div class="empty-state"><i class="fas fa-truck"></i><h3>–î–æ—Å—Ç–∞–≤–∫–∞</h3><p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p></div>
                </section>
                <section class="section" id="section-users">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                            <button class="btn btn-primary"><i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                        <table>
                            <thead><tr><th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th><th>Email</th><th>–†–æ–ª—å</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
                            <tbody>
                                <tr>
                                    <td><div style="display:flex;align-items:center;gap:12px;"><div class="table-avatar">–ê</div><strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</strong></div></td>
                                    <td>admin@example.com</td>
                                    <td>–í–ª–∞–¥–µ–ª–µ—Ü</td>
                                    <td><span class="status-badge active"><i class="fas fa-circle"></i> –ê–∫—Ç–∏–≤–µ–Ω</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                <section class="section" id="section-settings">
                    <div class="table-container" style="padding:24px;">
                        <h3 style="margin-bottom:24px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞</h3>
                        <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label><input type="text" id="settingsProjectName"></div>
                        <div class="form-group"><label>–î–æ–º–µ–Ω</label><input type="text" placeholder="example.com"></div>
                        <button class="btn btn-primary"><i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <div class="modal-header"><h2><i class="fas fa-sign-in-alt"></i> –í—Ö–æ–¥</h2></div>
            <div class="modal-body">
                <div id="loginError" style="display:none;padding:12px;background:rgba(239,68,68,0.1);border-radius:8px;margin-bottom:16px;color:var(--danger);"></div>
                <div class="form-group"><label>Email</label><input type="email" id="loginEmail" placeholder="admin@example.com"></div>
                <div class="form-group"><label>–ü–∞—Ä–æ–ª—å</label><input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="doLogin()"><i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- Create Page Modal -->
    <div class="modal-overlay" id="createPageModal">
        <div class="modal xlarge">
            <div class="modal-header">
                <h2><i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</h2>
                <button class="modal-close" onclick="closeModal('createPageModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="newPageName" placeholder="–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"></div>
                <div class="form-group"><label>–ü–∞–ø–∫–∞</label>
                    <select id="newPageFolder">
                        <option value="landings">–õ–µ–Ω–¥–∏–Ω–≥–∏</option>
                        <option value="">–ë–µ–∑ –ø–∞–ø–∫–∏</option>
                    </select>
                </div>
                <label style="font-weight:500;margin-bottom:12px;display:block;">–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω:</label>
                <div class="template-categories" id="modalCategories"></div>
                <div class="templates-grid" id="modalTemplatesGrid"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('createPageModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveNewPage()"><i class="fas fa-check"></i> –°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Create Folder Modal -->
    <div class="modal-overlay" id="createFolderModal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-folder-plus"></i> –ù–æ–≤–∞—è –ø–∞–ø–∫–∞</h2>
                <button class="modal-close" onclick="closeModal('createFolderModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="newFolderName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('createFolderModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveNewFolder()"><i class="fas fa-check"></i> –°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Create Project Modal -->
    <div class="modal-overlay" id="createProjectModal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-folder"></i> –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h2>
                <button class="modal-close" onclick="closeModal('createProjectModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="newProjectName" placeholder="–ú–æ–π –ø—Ä–æ–µ–∫—Ç"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('createProjectModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveNewProject()"><i class="fas fa-check"></i> –°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== API Client ====================
        const API_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
            ? `${location.protocol}//${location.hostname}:3000/api`
            : '/api';

        const api = {
            token: localStorage.getItem('cms_token'),
            refreshToken: localStorage.getItem('cms_refresh_token'),
            user: null,
            isOnline: false,

            headers() {
                const h = { 'Content-Type': 'application/json' };
                if (this.token) h['Authorization'] = 'Bearer ' + this.token;
                return h;
            },

            async request(method, path, body = null) {
                const opts = { method, headers: this.headers() };
                if (body) opts.body = JSON.stringify(body);
                try {
                    const res = await fetch(API_BASE + path, opts);
                    const data = await res.json();
                    if (res.status === 401 && this.refreshToken) {
                        const refreshed = await this.doRefresh();
                        if (refreshed) {
                            opts.headers['Authorization'] = 'Bearer ' + this.token;
                            const res2 = await fetch(API_BASE + path, opts);
                            return await res2.json();
                        }
                    }
                    return data;
                } catch (e) {
                    console.warn('API request failed:', e);
                    return { success: false, error: 'Network error', offline: true };
                }
            },

            async doRefresh() {
                try {
                    const res = await fetch(API_BASE + '/auth/refresh', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ refreshToken: this.refreshToken })
                    });
                    const data = await res.json();
                    if (data.success) {
                        this.token = data.data.accessToken;
                        localStorage.setItem('cms_token', this.token);
                        return true;
                    }
                } catch (e) {}
                this.logout();
                return false;
            },

            async login(email, password) {
                const res = await this.request('POST', '/auth/login', { email, password });
                if (res.success) {
                    this.token = res.data.accessToken;
                    this.refreshToken = res.data.refreshToken;
                    this.user = res.data.user;
                    localStorage.setItem('cms_token', this.token);
                    localStorage.setItem('cms_refresh_token', this.refreshToken);
                    this.isOnline = true;
                }
                return res;
            },

            async getMe() {
                const res = await this.request('GET', '/auth/me');
                if (res.success) {
                    this.user = res.data.user;
                    this.isOnline = true;
                }
                return res;
            },

            logout() {
                if (this.refreshToken) {
                    this.request('POST', '/auth/logout', { refreshToken: this.refreshToken }).catch(() => {});
                }
                this.token = null;
                this.refreshToken = null;
                this.user = null;
                this.isOnline = false;
                localStorage.removeItem('cms_token');
                localStorage.removeItem('cms_refresh_token');
            },

            get: (path) => api.request('GET', path),
            post: (path, body) => api.request('POST', path, body),
            put: (path, body) => api.request('PUT', path, body),
            del: (path) => api.request('DELETE', path)
        };

        // ==================== Templates ====================
        const pageTemplates = [
            { id: 'blank', name: '–ü—É—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞', category: 'basic', thumbnail: 'üìÑ' },
            { id: 'landing-basic', name: '–ë–∞–∑–æ–≤—ã–π –ª–µ–Ω–¥–∏–Ω–≥', category: 'basic', thumbnail: 'üöÄ' },
            { id: 'cosmetology', name: '–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è', category: 'education', thumbnail: 'üíâ' },
            { id: 'personal-coach', name: '–õ–∏—á–Ω—ã–π –∫–æ—É—á', category: 'personal', thumbnail: 'üéØ' },
            { id: 'shop-fashion', name: '–ú–∞–≥–∞–∑–∏–Ω –æ–¥–µ–∂–¥—ã', category: 'shop', thumbnail: 'üëó' },
            { id: 'realestate-agency', name: '–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏', category: 'realestate', thumbnail: 'üè†' },
            { id: 'realestate-developer', name: '–ó–∞—Å—Ç—Ä–æ–π—â–∏–∫', category: 'realestate', thumbnail: 'üèóÔ∏è' },
            { id: 'restaurant-main', name: '–†–µ—Å—Ç–æ—Ä–∞–Ω', category: 'restaurant', thumbnail: 'üçΩÔ∏è' },
            { id: 'restaurant-cafe', name: '–ö–∞—Ñ–µ', category: 'restaurant', thumbnail: '‚òï' },
            { id: 'restaurant-delivery', name: '–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã', category: 'restaurant', thumbnail: 'üçï' },
            { id: 'fitness-gym', name: '–§–∏—Ç–Ω–µ—Å-–∫–ª—É–±', category: 'fitness', thumbnail: 'üèãÔ∏è' },
            { id: 'fitness-trainer', name: '–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä', category: 'fitness', thumbnail: 'üí™' },
            { id: 'fitness-yoga', name: '–ô–æ–≥–∞-—Å—Ç—É–¥–∏—è', category: 'fitness', thumbnail: 'üßò' },
            { id: 'education-course', name: '–û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å', category: 'education', thumbnail: 'üìö' },
            { id: 'education-school', name: '–®–∫–æ–ª–∞/–ö—É—Ä—Å—ã', category: 'education', thumbnail: 'üéì' },
            { id: 'education-tutor', name: '–†–µ–ø–µ—Ç–∏—Ç–æ—Ä', category: 'education', thumbnail: 'üë®‚Äçüè´' },
            { id: 'services-beauty', name: '–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã', category: 'services', thumbnail: 'üíá' },
            { id: 'services-cleaning', name: '–ö–ª–∏–Ω–∏–Ω–≥', category: 'services', thumbnail: 'üßπ' },
            { id: 'services-auto', name: '–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å', category: 'services', thumbnail: 'üöó' },
            { id: 'events-conference', name: '–ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è', category: 'events', thumbnail: 'üé§' },
            { id: 'events-wedding', name: '–°–≤–∞–¥—å–±–∞', category: 'events', thumbnail: 'üíí' },
            { id: 'events-party', name: '–ü—Ä–∞–∑–¥–Ω–∏–∫', category: 'events', thumbnail: 'üéâ' },
            { id: 'portfolio', name: '–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ', category: 'personal', thumbnail: 'üé®' },
            { id: 'business-card', name: '–í–∏–∑–∏—Ç–∫–∞', category: 'personal', thumbnail: 'üíº' }
        ];

        // ==================== State ====================
        let projects = [], pages = [], folders = [], users = [];
        let currentProject = null, currentFolder = 'all', selectedTemplateId = 'blank';
        const STORAGE_KEY = 'landing_pages';

        // ==================== Init ====================
        document.addEventListener('DOMContentLoaded', async () => {
            setupNavigation();
            setupProjectSelector();
            setupTabs();
            setupTemplateCategories();

            // Try to authenticate with existing token
            if (api.token) {
                const me = await api.getMe();
                if (me.success) {
                    api.isOnline = true;
                    updateUserUI();
                    await loadDataFromAPI();
                    renderAll();
                    return;
                }
            }

            // Check if API is available
            const health = await api.get('/health');
            if (health.success) {
                openModal('loginModal');
            } else {
                // Offline mode - use localStorage
                loadDataLocal();
                renderAll();
            }
        });

        // ==================== Data Loading ====================
        async function loadDataFromAPI() {
            // Load projects
            const projRes = await api.get('/projects');
            if (projRes.success) {
                projects = projRes.data || [];
                if (projects.length > 0) {
                    currentProject = projects[0];
                    document.getElementById('currentProjectName').textContent = currentProject.name;
                }
            }

            if (currentProject) {
                // Load pages for current project
                const pagesRes = await api.get('/pages?project_id=' + currentProject.id);
                if (pagesRes.success) {
                    pages = (pagesRes.data || []).map(p => ({
                        id: p.id,
                        name: p.name,
                        folder: p.folder_id || 'landings',
                        template: (() => { try { const c = JSON.parse(p.content || '{}'); return c.template || 'blank'; } catch(e) { return 'blank'; } })(),
                        elements: (() => { try { const c = JSON.parse(p.content || '{}'); return c.elements || []; } catch(e) { return []; } })(),
                        createdAt: p.created_at,
                        updatedAt: p.updated_at,
                        _raw: p
                    }));
                }

                // Load folders
                const foldersRes = await api.get('/pages/folders/list?project_id=' + currentProject.id);
                if (foldersRes.success) {
                    folders = (foldersRes.data || []).map(f => ({ id: f.id, name: f.name }));
                }
            }

            // Sync to localStorage as cache
            localStorage.setItem(STORAGE_KEY, JSON.stringify(pages));
            localStorage.setItem('cms_folders', JSON.stringify(folders));
            localStorage.setItem('cms_projects', JSON.stringify(projects));

            // Load users if admin
            if (api.user && (api.user.role === 'owner' || api.user.role === 'admin')) {
                const usersRes = await api.get('/users');
                if (usersRes.success) {
                    users = usersRes.data || [];
                    renderUsersTable();
                }
            }
        }

        function loadDataLocal() {
            projects = JSON.parse(localStorage.getItem('cms_projects') || '[]');
            if (projects.length === 0) {
                projects.push({ id: generateId(), name: '–ú–æ–π –ø—Ä–æ–µ–∫—Ç', created: new Date().toISOString() });
                localStorage.setItem('cms_projects', JSON.stringify(projects));
            }
            currentProject = projects[0];
            document.getElementById('currentProjectName').textContent = currentProject.name;
            pages = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            folders = JSON.parse(localStorage.getItem('cms_folders') || '[]');
        }

        function saveDataLocal() {
            localStorage.setItem('cms_projects', JSON.stringify(projects));
            localStorage.setItem(STORAGE_KEY, JSON.stringify(pages));
            localStorage.setItem('cms_folders', JSON.stringify(folders));
        }

        function generateId() { return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9); }

        // ==================== Auth ====================
        async function doLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');

            if (!email || !password) {
                errorEl.textContent = '–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å';
                errorEl.style.display = 'block';
                return;
            }

            errorEl.style.display = 'none';
            const res = await api.login(email, password);

            if (res.success) {
                closeModal('loginModal');
                updateUserUI();
                await loadDataFromAPI();
                renderAll();
            } else {
                errorEl.textContent = res.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
                errorEl.style.display = 'block';
            }
        }

        function doLogout() {
            api.logout();
            pages = [];
            projects = [];
            folders = [];
            users = [];
            openModal('loginModal');
            renderAll();
        }

        function updateUserUI() {
            if (api.user) {
                const nameEl = document.querySelector('.user-name');
                const roleEl = document.querySelector('.user-role');
                const avatarEl = document.querySelector('.user-avatar');
                if (nameEl) nameEl.textContent = api.user.name;
                const roles = { owner: '–í–ª–∞–¥–µ–ª–µ—Ü', admin: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', manager: '–ú–µ–Ω–µ–¥–∂–µ—Ä', editor: '–†–µ–¥–∞–∫—Ç–æ—Ä', client: '–ö–ª–∏–µ–Ω—Ç' };
                if (roleEl) roleEl.textContent = roles[api.user.role] || api.user.role;
                if (avatarEl) avatarEl.textContent = (api.user.name || 'U').charAt(0).toUpperCase();
            }
        }

        // Handle Enter key in login form
        document.addEventListener('keydown', e => {
            if (e.key === 'Enter' && document.getElementById('loginModal').classList.contains('open')) {
                doLogin();
            }
        });

        // ==================== Navigation ====================
        function setupNavigation() {
            document.querySelectorAll('.nav-item[data-section]').forEach(item => {
                item.addEventListener('click', () => switchSection(item.dataset.section));
            });
            document.querySelectorAll('.nav-item-parent').forEach(item => {
                item.addEventListener('click', () => {
                    item.classList.toggle('open');
                    document.getElementById('submenu-' + item.dataset.submenu).classList.toggle('open');
                });
            });
        }

        function switchSection(sectionId) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.querySelector(`.nav-item[data-section="${sectionId}"]`)?.classList.add('active');
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-' + sectionId)?.classList.add('active');
            const titles = { dashboard: '–î–∞—à–±–æ—Ä–¥', pages: '–°—Ç—Ä–∞–Ω–∏—Ü—ã', products: '–¢–æ–≤–∞—Ä—ã', services: '–£—Å–ª—É–≥–∏', digital: '–û–Ω–ª–∞–π–Ω-–ø—Ä–æ–¥—É–∫—Ç—ã', specialists: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã', orders: '–ó–∞–∫–∞–∑—ã', payments: '–ü–ª–∞—Ç–µ–∂–∏', warehouse: '–°–∫–ª–∞–¥', delivery: '–î–æ—Å—Ç–∞–≤–∫–∞', users: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏', settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏' };
            document.getElementById('sectionTitle').textContent = titles[sectionId] || sectionId;

            // Load users when switching to users section
            if (sectionId === 'users' && api.isOnline) loadUsers();
        }

        // ==================== Projects ====================
        function setupProjectSelector() {
            const dropdown = document.getElementById('projectDropdown');
            const menu = document.getElementById('projectMenu');
            dropdown.onclick = () => { menu.classList.toggle('open'); renderProjectMenu(); };
            document.addEventListener('click', e => { if (!dropdown.contains(e.target) && !menu.contains(e.target)) menu.classList.remove('open'); });
        }

        function renderProjectMenu() {
            const menu = document.getElementById('projectMenu');
            menu.innerHTML = projects.map(p => `
                <div class="project-menu-item ${currentProject && p.id === currentProject.id ? 'active' : ''}" onclick="switchProject('${p.id}')">
                    <i class="fas fa-folder"></i><span>${escapeHtml(p.name)}</span>
                </div>
            `).join('') + '<div class="project-menu-divider"></div><div class="project-menu-item create" onclick="openModal(\'createProjectModal\')"><i class="fas fa-plus"></i><span>–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</span></div>';
        }

        async function switchProject(id) {
            currentProject = projects.find(p => p.id === id);
            document.getElementById('currentProjectName').textContent = currentProject.name;
            document.getElementById('projectMenu').classList.remove('open');

            if (api.isOnline && currentProject) {
                const pagesRes = await api.get('/pages?project_id=' + currentProject.id);
                if (pagesRes.success) {
                    pages = (pagesRes.data || []).map(p => ({
                        id: p.id, name: p.name, folder: p.folder_id || 'landings',
                        template: (() => { try { return JSON.parse(p.content || '{}').template || 'blank'; } catch(e) { return 'blank'; } })(),
                        elements: (() => { try { return JSON.parse(p.content || '{}').elements || []; } catch(e) { return []; } })(),
                        createdAt: p.created_at, updatedAt: p.updated_at, _raw: p
                    }));
                }
                const foldersRes = await api.get('/pages/folders/list?project_id=' + currentProject.id);
                if (foldersRes.success) folders = (foldersRes.data || []).map(f => ({ id: f.id, name: f.name }));
            }
            renderAll();
        }

        async function saveNewProject() {
            const name = document.getElementById('newProjectName').value || '–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç';

            if (api.isOnline) {
                const res = await api.post('/projects', { name });
                if (res.success) {
                    projects.push(res.data);
                    closeModal('createProjectModal');
                    switchProject(res.data.id);
                    return;
                }
            }

            // Fallback to localStorage
            const proj = { id: generateId(), name, created: new Date().toISOString() };
            projects.push(proj);
            saveDataLocal();
            closeModal('createProjectModal');
            switchProject(proj.id);
        }

        // ==================== Tabs ====================
        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.onclick = () => {
                    const parent = tab.closest('.section');
                    parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    parent.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById('tab-' + tab.dataset.tab)?.classList.add('active');
                };
            });
        }

        function setupTemplateCategories() {
            document.querySelectorAll('.template-category').forEach(btn => {
                btn.onclick = () => {
                    btn.closest('.template-categories').querySelectorAll('.template-category').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderTemplates(btn.dataset.category, btn.closest('.tab-content') ? 'templatesGrid' : 'modalTemplatesGrid');
                };
            });
        }

        // ==================== Rendering ====================
        function renderAll() {
            renderPages();
            renderFolders();
            renderTemplates('all', 'templatesGrid');
            updateStats();
        }

        function renderPages() {
            const filtered = currentFolder === 'all' ? pages : currentFolder === 'landings' ? pages.filter(p => p.folder === 'landings' || !p.folder) : pages.filter(p => p.folder === currentFolder);
            const grid = document.getElementById('pagesGrid');
            const recent = document.getElementById('recentPages');

            let html = `<div class="card new" onclick="createPage()"><i class="fas fa-plus-circle"></i><span>–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</span></div>`;
            filtered.forEach(page => {
                const date = new Date(page.updatedAt || page.createdAt).toLocaleDateString('ru-RU');
                html += `
                    <div class="card">
                        <div class="card-preview"><i class="fas fa-file-alt card-preview-placeholder"></i></div>
                        <div class="card-body">
                            <div class="card-title"><input value="${escapeHtml(page.name)}" onchange="renamePage('${page.id}', this.value)"></div>
                            <div class="card-meta">–ò–∑–º–µ–Ω–µ–Ω: ${date}</div>
                            <div class="card-actions">
                                <button class="card-action primary" onclick="editPage('${page.id}')"><i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="card-action" onclick="duplicatePage('${page.id}')"><i class="fas fa-copy"></i></button>
                                <button class="card-action danger" onclick="deletePage('${page.id}')"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>`;
            });
            grid.innerHTML = html;

            // Recent pages on dashboard (max 6)
            let recentHtml = `<div class="card new" onclick="createPage()"><i class="fas fa-plus-circle"></i><span>–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</span></div>`;
            pages.slice(0, 5).forEach(page => {
                const date = new Date(page.updatedAt || page.createdAt).toLocaleDateString('ru-RU');
                recentHtml += `
                    <div class="card">
                        <div class="card-preview"><i class="fas fa-file-alt card-preview-placeholder"></i></div>
                        <div class="card-body">
                            <div class="card-title"><input value="${escapeHtml(page.name)}" onchange="renamePage('${page.id}', this.value)"></div>
                            <div class="card-meta">–ò–∑–º–µ–Ω–µ–Ω: ${date}</div>
                            <div class="card-actions">
                                <button class="card-action primary" onclick="editPage('${page.id}')"><i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="card-action" onclick="duplicatePage('${page.id}')"><i class="fas fa-copy"></i></button>
                                <button class="card-action danger" onclick="deletePage('${page.id}')"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>`;
            });
            recent.innerHTML = recentHtml;

            document.getElementById('pagesCount').textContent = pages.length;
            document.getElementById('allPagesCount').textContent = pages.length;
            document.getElementById('landingsCount').textContent = pages.filter(p => p.folder === 'landings' || !p.folder).length;
        }

        function renderFolders() {
            const foldersEl = document.getElementById('foldersList');
            // Update folder select in create page modal
            const folderSelect = document.getElementById('newPageFolder');
            let optionsHtml = '<option value="landings">–õ–µ–Ω–¥–∏–Ω–≥–∏</option><option value="">–ë–µ–∑ –ø–∞–ø–∫–∏</option>';

            let foldersHtml = '';
            folders.forEach(f => {
                foldersHtml += `
                    <div class="folder-item ${currentFolder === f.id ? 'active' : ''}" data-folder="${f.id}" onclick="selectFolder('${f.id}')">
                        <i class="fas fa-folder"></i><span>${escapeHtml(f.name)}</span>
                        <span class="count">${pages.filter(p => p.folder === f.id).length}</span>
                    </div>`;
                optionsHtml += `<option value="${f.id}">${escapeHtml(f.name)}</option>`;
            });

            foldersEl.innerHTML = foldersHtml;
            folderSelect.innerHTML = optionsHtml;
        }

        function renderTemplates(category, gridId) {
            const grid = document.getElementById(gridId);
            if (!grid) return;
            const filtered = category === 'all' ? pageTemplates : pageTemplates.filter(t => t.category === category);
            grid.innerHTML = filtered.map(t => `
                <div class="template-card ${selectedTemplateId === t.id ? 'selected' : ''}" onclick="selectTemplate('${t.id}')">
                    <div class="template-card-icon">${t.thumbnail}</div>
                    <div class="template-card-name">${t.name}</div>
                </div>
            `).join('');
        }

        function selectTemplate(id) {
            selectedTemplateId = id;
            renderTemplates(document.querySelector('#modalCategories .template-category.active')?.dataset.category || 'all', 'modalTemplatesGrid');
        }

        function selectFolder(id) {
            currentFolder = id;
            document.querySelectorAll('.folder-item').forEach(f => f.classList.toggle('active', f.dataset.folder === id));
            renderPages();
        }

        function updateStats() {
            document.getElementById('stat-pages').textContent = pages.length;
            document.getElementById('stat-users').textContent = users.length || 1;
        }

        // ==================== Users ====================
        async function loadUsers() {
            if (!api.isOnline) return;
            const res = await api.get('/users');
            if (res.success) {
                users = res.data || [];
                renderUsersTable();
            }
        }

        function renderUsersTable() {
            const tbody = document.querySelector('#section-users table tbody');
            if (!tbody) return;

            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4"><div class="empty-state"><i class="fas fa-users"></i><h3>–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3></div></td></tr>';
                return;
            }

            const roles = { owner: '–í–ª–∞–¥–µ–ª–µ—Ü', admin: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', manager: '–ú–µ–Ω–µ–¥–∂–µ—Ä', editor: '–†–µ–¥–∞–∫—Ç–æ—Ä', client: '–ö–ª–∏–µ–Ω—Ç' };
            tbody.innerHTML = users.map(u => `
                <tr>
                    <td>
                        <div style="display:flex;align-items:center;gap:12px;">
                            <div class="table-avatar">${(u.name || 'U').charAt(0).toUpperCase()}</div>
                            <strong>${escapeHtml(u.name)}</strong>
                        </div>
                    </td>
                    <td>${escapeHtml(u.email)}</td>
                    <td>${roles[u.role] || u.role}</td>
                    <td><span class="status-badge ${u.is_active ? 'active' : ''}"><i class="fas fa-circle"></i> ${u.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}</span></td>
                </tr>
            `).join('');

            document.getElementById('stat-users').textContent = users.length;
        }

        // ==================== Pages CRUD ====================
        function createPage() {
            selectedTemplateId = 'blank';
            document.getElementById('newPageName').value = '';
            renderModalCategories();
            renderTemplates('all', 'modalTemplatesGrid');
            openModal('createPageModal');
        }

        function renderModalCategories() {
            const cats = ['all', 'basic', 'personal', 'shop', 'realestate', 'restaurant', 'fitness', 'education', 'services', 'events'];
            const names = { all: '–í—Å–µ', basic: '–ë–∞–∑–æ–≤—ã–µ', personal: '–õ–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥', shop: '–ú–∞–≥–∞–∑–∏–Ω', realestate: '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å', restaurant: '–†–µ—Å—Ç–æ—Ä–∞–Ω—ã', fitness: '–§–∏—Ç–Ω–µ—Å', education: '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', services: '–£—Å–ª—É–≥–∏', events: '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è' };
            document.getElementById('modalCategories').innerHTML = cats.map(c => `<button class="template-category ${c === 'all' ? 'active' : ''}" data-category="${c}" onclick="filterModalTemplates('${c}')">${names[c]}</button>`).join('');
        }

        function filterModalTemplates(category) {
            document.querySelectorAll('#modalCategories .template-category').forEach(b => b.classList.toggle('active', b.dataset.category === category));
            renderTemplates(category, 'modalTemplatesGrid');
        }

        async function saveNewPage() {
            const name = document.getElementById('newPageName').value || '–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞';
            const folder = document.getElementById('newPageFolder').value;

            if (api.isOnline && currentProject) {
                const res = await api.post('/pages', {
                    project_id: currentProject.id,
                    name,
                    folder_id: (folder && folder !== 'landings') ? folder : null,
                    template: selectedTemplateId,
                    content: { template: selectedTemplateId, elements: [] }
                });

                if (res.success) {
                    const newPage = {
                        id: res.data.id,
                        name: res.data.name,
                        folder: folder || 'landings',
                        template: selectedTemplateId,
                        elements: [],
                        createdAt: res.data.created_at,
                        updatedAt: res.data.updated_at
                    };
                    pages.unshift(newPage);
                    saveDataLocal();
                    closeModal('createPageModal');
                    window.location.href = `index.html?id=${newPage.id}${selectedTemplateId !== 'blank' ? '&template=' + selectedTemplateId : ''}`;
                    return;
                }
            }

            // Fallback to localStorage
            const newPage = {
                id: 'page_' + Date.now(),
                name,
                folder: folder || 'landings',
                template: selectedTemplateId,
                elements: [],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            pages.unshift(newPage);
            saveDataLocal();
            closeModal('createPageModal');
            window.location.href = `index.html?id=${newPage.id}${selectedTemplateId !== 'blank' ? '&template=' + selectedTemplateId : ''}`;
        }

        function editPage(id) { window.location.href = `index.html?id=${id}`; }

        async function renamePage(id, name) {
            const page = pages.find(p => p.id === id);
            if (!page) return;
            page.name = name;
            page.updatedAt = new Date().toISOString();

            if (api.isOnline) {
                await api.put('/pages/' + id, { name });
            }
            saveDataLocal();
        }

        async function duplicatePage(id) {
            if (api.isOnline) {
                const res = await api.post('/pages/' + id + '/duplicate');
                if (res.success) {
                    const p = res.data;
                    pages.unshift({
                        id: p.id, name: p.name, folder: p.folder_id || 'landings',
                        template: (() => { try { return JSON.parse(p.content || '{}').template || 'blank'; } catch(e) { return 'blank'; } })(),
                        elements: (() => { try { return JSON.parse(p.content || '{}').elements || []; } catch(e) { return []; } })(),
                        createdAt: p.created_at, updatedAt: p.updated_at
                    });
                    saveDataLocal();
                    renderPages();
                    return;
                }
            }

            // Fallback
            const page = pages.find(p => p.id === id);
            if (page) {
                const copy = { ...JSON.parse(JSON.stringify(page)), id: 'page_' + Date.now(), name: page.name + ' (–∫–æ–ø–∏—è)', createdAt: new Date().toISOString() };
                pages.unshift(copy);
                saveDataLocal();
                renderPages();
            }
        }

        async function deletePage(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?')) return;

            if (api.isOnline) {
                await api.del('/pages/' + id);
            }

            pages = pages.filter(p => p.id !== id);
            saveDataLocal();
            renderPages();
            updateStats();
        }

        // ==================== Folders CRUD ====================
        function createFolder() { document.getElementById('newFolderName').value = ''; openModal('createFolderModal'); }

        async function saveNewFolder() {
            const name = document.getElementById('newFolderName').value;
            if (!name) return;

            if (api.isOnline && currentProject) {
                const res = await api.post('/pages/folders', { project_id: currentProject.id, name });
                if (res.success) {
                    folders.push({ id: res.data.id, name: res.data.name });
                    saveDataLocal();
                    renderFolders();
                    closeModal('createFolderModal');
                    return;
                }
            }

            // Fallback
            folders.push({ id: generateId(), name });
            saveDataLocal();
            renderFolders();
            closeModal('createFolderModal');
        }

        // ==================== Modals ====================
        function openModal(id) { document.getElementById(id).classList.add('open'); }
        function closeModal(id) { document.getElementById(id).classList.remove('open'); }

        // Close modal on overlay click
        document.addEventListener('click', e => {
            if (e.target.classList.contains('modal-overlay') && e.target.id !== 'loginModal') {
                e.target.classList.remove('open');
            }
        });

        // ==================== Helpers ====================
        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }
    </script>
</body>
</html>
