<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∫–ª–∞–º–∞ –∫–∞–Ω–∞–ª–∞</title>
    <link rel="stylesheet" href="style.css?v=4">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <a href="../" class="back-link">‚Üê –ù–∞–∑–∞–¥</a>
                <h1>üì¢ –†–µ–∫–ª–∞–º–∞ –∫–∞–Ω–∞–ª–∞</h1>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" id="addChannelBtn">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª</button>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" data-tab="channels">–ö–∞–Ω–∞–ª—ã</button>
                <button class="tab" data-tab="links">–°—Å—ã–ª–∫–∏</button>
                <button class="tab" data-tab="stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Channels Tab -->
            <section class="tab-content active" id="tab-channels">
                <div class="channels-list" id="channelsList">
                    <!-- Will be populated -->
                </div>

                <!-- No Channels State -->
                <div class="empty-state" id="noChannelsState" style="display: none;">
                    <div class="empty-icon">üì∫</div>
                    <h2>–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤</h2>
                    <p>–î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤ –≤–∞—à Telegram –∫–∞–Ω–∞–ª</p>
                    <button class="btn btn-primary btn-large" id="addFirstChannelBtn">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª</button>
                </div>
            </section>

            <!-- Links Tab -->
            <section class="tab-content" id="tab-links">
                <div class="filter-row">
                    <div class="filter-group">
                        <label>–ö–∞–Ω–∞–ª:</label>
                        <select id="linksChannelSelect">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="createLinkBtn" disabled>+ –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                </div>

                <div class="links-list" id="linksList">
                    <!-- Will be populated -->
                </div>

                <div class="empty-state" id="noLinksState" style="display: none;">
                    <div class="empty-icon">üîó</div>
                    <h2>–ù–µ—Ç —Å—Å—ã–ª–æ–∫</h2>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å—Å—ã–ª–∫—É —Å UTM-–º–µ—Ç–∫–∞–º–∏</p>
                </div>
            </section>

            <!-- Stats Tab -->
            <section class="tab-content" id="tab-stats">
                <div class="filter-row">
                    <div class="filter-group">
                        <label>–ö–∞–Ω–∞–ª:</label>
                        <select id="statsChannelSelect">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª</option>
                        </select>
                    </div>
                </div>

                <div id="statsContent" style="display: none;">
                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="statVisits">0</div>
                            <div class="stat-label">–í–∏–∑–∏—Ç—ã</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statSubscribers">0</div>
                            <div class="stat-label">–ü–æ–¥–ø–∏—Å–∫–∏</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statConversion">0%</div>
                            <div class="stat-label">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</div>
                        </div>
                    </div>

                    <!-- UTM Stats Table -->
                    <div class="card">
                        <div class="card-header">
                            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º</h3>
                        </div>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                                        <th>–ö–∞–º–ø–∞–Ω–∏—è</th>
                                        <th>–í–∏–∑–∏—Ç—ã</th>
                                        <th>–ü–æ–¥–ø–∏—Å–∫–∏</th>
                                        <th>CR</th>
                                    </tr>
                                </thead>
                                <tbody id="utmStatsTable">
                                    <!-- Will be populated -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="empty-state" id="noStatsState">
                    <div class="empty-icon">üìä</div>
                    <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª</h2>
                    <p>–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª –∏–∑ —Å–ø–∏—Å–∫–∞</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Channel Modal -->
    <div class="modal-overlay" id="addChannelModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª</h3>
                <button class="modal-close" id="closeChannelModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Platform Selector -->
                <div class="platform-selector">
                    <button class="platform-btn active" data-platform="telegram" onclick="selectPlatform('telegram')">
                        <span class="platform-icon">üì±</span>
                        <span class="platform-name">Telegram</span>
                    </button>
                    <button class="platform-btn" data-platform="max" onclick="selectPlatform('max')">
                        <span class="platform-icon">üí¨</span>
                        <span class="platform-name">MAX</span>
                    </button>
                </div>

                <!-- Telegram Instructions -->
                <div class="instruction-box platform-instructions" id="telegram-instructions">
                    <h4>–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ Telegram –∫–∞–Ω–∞–ª:</h4>
                    <ol>
                        <li>–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –∫–∞–Ω–∞–ª –≤ Telegram</li>
                        <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞</b> ‚Üí <b>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</b></li>
                        <li>–ù–∞–∂–º–∏—Ç–µ <b>–î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</b></li>
                        <li>–ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞: <code>@PKmarketingBot</code></li>
                        <li>–î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ <b>—á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π</b></li>
                        <li>–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ</li>
                    </ol>
                </div>

                <!-- MAX Instructions -->
                <div class="instruction-box platform-instructions" id="max-instructions" style="display: none;">
                    <h4>–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ MAX –∫–∞–Ω–∞–ª:</h4>
                    <ol>
                        <li>–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –∫–∞–Ω–∞–ª –≤ MAX</li>
                        <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b> ‚Üí <b>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</b></li>
                        <li>–î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞: <code>@PKmarketingBot</code></li>
                        <li>–î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–º</li>
                        <li>–ö–∞–Ω–∞–ª –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –ø–æ—Å–ª–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è</li>
                    </ol>
                    <div class="max-discover-section">
                        <button class="btn btn-primary btn-small" id="discoverMaxChannelsBtn" onclick="discoverMaxChannels()">
                            üîç –ù–∞–π—Ç–∏ MAX –∫–∞–Ω–∞–ª—ã
                        </button>
                        <span class="discover-status" id="discoverStatus"></span>
                    </div>
                </div>

                <div class="pending-channels" id="pendingChannels" style="display: none;">
                    <h4>–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã:</h4>
                    <div class="pending-channels-list" id="pendingChannelsList">
                        <!-- Channels will appear here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelChannelBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Channel Settings Modal -->
    <div class="modal-overlay" id="channelSettingsModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞</h3>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="settingsChannelCode">

                <h4 class="settings-section-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h4>

                <div class="form-group">
                    <label>ID —Å—á—ë—Ç—á–∏–∫–∞ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∏</label>
                    <input type="text" id="settingsYmId" placeholder="12345678">
                    <div class="form-hint">–ù–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ú–µ—Ç—Ä–∏–∫–∏: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ‚Üí –ö–æ–¥ —Å—á—ë—Ç—á–∏–∫–∞</div>
                </div>

                <div class="form-group">
                    <label>ID –ø–∏–∫—Å–µ–ª—è VK –†–µ–∫–ª–∞–º—ã</label>
                    <input type="text" id="settingsVkPixel" placeholder="VK-RTRG-123456-xxxxx">
                    <div class="form-hint">–ù–∞–π–¥–∏—Ç–µ –≤ VK –†–µ–∫–ª–∞–º–µ: –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ ‚Üí –ü–∏–∫—Å–µ–ª–∏</div>
                </div>

                <div class="divider"></div>

                <h4 class="settings-section-title">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MAX</h4>

                <div class="max-status" id="maxStatus">
                    <div class="max-status-icon">üì±</div>
                    <div class="max-status-text">
                        <span id="maxStatusLabel">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>

                <div class="form-group" id="maxConnectGroup" style="display: none;">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª MAX</label>
                    <select id="settingsMaxChat">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª</option>
                    </select>
                    <div class="form-hint">–î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ MAX –≤ –∫–∞–Ω–∞–ª, –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏—Ç–µ –µ–≥–æ –∑–¥–µ—Å—å</div>
                </div>

                <div id="maxConnectedInfo" style="display: none;">
                    <div class="connected-badge">
                        <span class="badge active">‚úì MAX –ø–æ–¥–∫–ª—é—á–µ–Ω</span>
                        <button class="btn btn-outline btn-small btn-danger" id="disconnectMaxBtn">–û—Ç–∫–ª—é—á–∏—Ç—å</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelSettingsBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="saveSettingsBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Create Link Modal -->
    <div class="modal-overlay" id="createLinkModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>–°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É</h3>
                <button class="modal-close" id="closeLinkModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ *</label>
                    <input type="text" id="linkName" placeholder="–†–µ–∫–ª–∞–º–∞ –≤ –í–ö">
                </div>

                <div class="form-group">
                    <label>UTM Source *</label>
                    <input type="text" id="linkUtmSource" placeholder="vk, instagram, google, yandex">
                    <div class="form-hint">–ò—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞</div>
                </div>

                <div class="form-group">
                    <label>UTM Medium</label>
                    <input type="text" id="linkUtmMedium" placeholder="cpc, banner, post, story">
                    <div class="form-hint">–¢–∏–ø —Ç—Ä–∞—Ñ–∏–∫–∞</div>
                </div>

                <div class="form-group">
                    <label>UTM Campaign</label>
                    <input type="text" id="linkUtmCampaign" placeholder="winter_sale, promo_january">
                    <div class="form-hint">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelLinkBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="saveLinkBtn">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Link Created Modal -->
    <div class="modal-overlay" id="linkCreatedModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>–°—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!</h3>
                <button class="modal-close" id="closeLinkCreatedModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–í–∞—à–∞ —Å—Å—ã–ª–∫–∞:</label>
                    <div class="link-display">
                        <input type="text" id="createdLinkUrl" readonly>
                        <button class="btn btn-primary" id="copyLinkBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>
                <div class="instruction-box">
                    <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ —Ä–µ–∫–ª–∞–º–µ. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–π–¥—ë—Ç –ø–æ –Ω–µ–π –∏ –ø–æ–¥–ø–∏—à–µ—Ç—Å—è –Ω–∞ –∫–∞–Ω–∞–ª ‚Äî —ç—Ç–æ –±—É–¥–µ—Ç –æ—Ç—Å–ª–µ–∂–µ–Ω–æ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="closeLinkCreatedBtn">–ì–æ—Ç–æ–≤–æ</button>
            </div>
        </div>
    </div>

    <!-- Link Settings Modal -->
    <div class="modal-overlay" id="linkSettingsModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Å—ã–ª–∫–∏</h3>
                <button class="modal-close" id="closeLinkSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editLinkId">

                <div class="form-group">
                    <label>–í–∞—à–∞ —Å—Å—ã–ª–∫–∞:</label>
                    <div class="link-display">
                        <input type="text" id="editLinkUrl" readonly>
                        <button class="btn btn-outline btn-small" onclick="copyToClipboard(document.getElementById('editLinkUrl').value)">üìã</button>
                    </div>
                </div>

                <div class="divider"></div>

                <h4 class="settings-section-title">–Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞</h4>

                <div class="form-group">
                    <label>–ù–æ–º–µ—Ä —Å—á—ë—Ç—á–∏–∫–∞ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∏</label>
                    <input type="text" id="editYmCounterId" placeholder="12345678">
                    <div class="form-hint">–°—á—ë—Ç—á–∏–∫ –±—É–¥–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω –≤ Mini App –¥–ª—è —ç—Ç–æ–π —Å—Å—ã–ª–∫–∏</div>
                </div>

                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏ (JS-—Å–æ–±—ã—Ç–∏–µ)</label>
                    <input type="text" id="editYmGoalName" placeholder="subscribe_channel">
                    <div class="form-hint">–¶–µ–ª—å —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –ø–æ–¥–ø–∏—Å–∫–∏ –≤ Mini App</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelLinkSettingsBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="saveLinkSettingsBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="script.js?v=4"></script>
</body>
</html>
